# atlantis.yaml
version: 3
projects:
# If two or more projects have the same dir and workspace, they must also have
# a 'name' key to differentiate them.
- name: Development-VPC
  dir: infrastructure/eu-west-1/dev/vpc
  terraform_version: v1.5.7
  workflow: Development
- name:  Production-VPC
  dir:  infrastructure/us-east-2/prod/vpc
  terraform_version: v1.5.7
  workflow: Production
  
  # repos.yaml or atlantis.yaml

# Instead of terraform commands, run these for plan and apply
workflows:
  Development:
    plan:
      steps:
        - env:
            name: TF_WORKSPACE
            command: 'echo $WORKSPACE'
        - env:
            # Reduce Terraform suggestion output
            name: TF_IN_AUTOMATION
            value: 'true'
        - env:
            name: TERRAGRUNT_TFPATH
            command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'

        - run: terragrunt init -input=false -no-color
        - run: terragrunt plan -input=false -no-color -out $PLANFILE
    apply:
      steps:
        - run: terragrunt apply -input=false -no-color $PLANFILE

  Production:
    plan:
      steps:
        - env:
            name: TF_WORKSPACE
            command: 'echo $WORKSPACE'
        - env:
            # Reduce Terraform suggestion output
            name: TF_IN_AUTOMATION
            value: 'true'         
        - env:
            name: TERRAGRUNT_TFPATH
            command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'

        - run: terragrunt init -input=false -no-color
        - run: terragrunt plan -input=false -no-color -out $PLANFILE
  
    apply:
      steps:
        - run: terragrunt apply -input=false -no-color $PLANFILE
    