# atlantis.yaml
version: 3
projects:
# If two or more projects have the same dir and workspace, they must also have
# a 'name' key to differentiate them.
- name: vpc-dev
  dir: vpc
  terraform_version: v1.5.7
  workflow: dev
- name: vpc-production
  dir: vpc
  terraform_version: v1.5.7
  workflow: production

workflows:
  dev:
    plan:
      steps:
        - env:
            name: TF_WORKSPACE
            command: 'echo $WORKSPACE'
        - env:
            # Reduce Terraform suggestion output
            name: TF_IN_AUTOMATION
            value: 'true'

        - init
          # If you're using workspaces you need to select the workspace using the
        # $WORKSPACE environment variable.     
        - run: terraform workspace select $WORKSPACE

        - plan:
            extra_args: ["-var-file", "dev.tfvars"]
    apply:
        steps:
          - apply

  production:
    plan:
      steps:
        - env:
            name: TF_WORKSPACE
            command: 'echo $WORKSPACE'
        - env:
            # Reduce Terraform suggestion output
            name: TF_IN_AUTOMATION
            value: 'true'

        - init

        # If you're using workspaces you need to select the workspace using the
        # $WORKSPACE environment variable.
        - run: terraform workspace select $WORKSPACE

        - plan:
            extra_args: ["-var-file", "production.tfvars"]
    apply:
      steps:
        - apply:

